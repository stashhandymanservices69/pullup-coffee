import React, { useState } from 'react';

// --- Icons (Built-in so you don't need to install anything) ---
const Icons = {
  Car: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></svg>,
  Coffee: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17 8h1a4 4 0 1 1 0 8h-1"/><path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>,
  User: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
  Store: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7"/><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4"/><path d="M2 7h20"/><path d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7"/></svg>,
  X: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>,
  ChevronRight: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m9 18 6-6-6-6"/></svg>,
  CheckCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
  MapPin: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>,
  Trash2: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
};

// --- Configuration ---
const CURBSIDE_FEE = 2.00; 

const MENU_ITEMS = [
  { id: 1, name: 'Flat White', price: 4.50, desc: 'Smooth texture, double shot' },
  { id: 2, name: 'Cappuccino', price: 4.50, desc: 'Frothy and dusted with chocolate' },
  { id: 3, name: 'Latte', price: 4.50, desc: 'Creamy and milky' },
  { id: 4, name: 'Long Black', price: 4.00, desc: 'Double shot over hot water' },
  { id: 5, name: 'Iced Latte', price: 5.50, desc: 'Served over ice' },
  { id: 6, name: 'Babyccino', price: 1.00, desc: 'For the little one (if they wake up!)' },
];

export default function App() {
  // --- App State ---
  const [view, setView] = useState('landing'); 
  const [cart, setCart] = useState([]);
  const [activeOrders, setActiveOrders] = useState([]);
  const [isCafeOpen, setIsCafeOpen] = useState(true);
  
  // Customer Details
  const [customerName, setCustomerName] = useState('');
  const [carModel, setCarModel] = useState('');
  const [carColor, setCarColor] = useState('');
  const [plateNumber, setPlateNumber] = useState('');

  // --- Actions ---

  const addToCart = (item) => {
    setCart([...cart, { ...item, cartId: Math.random() }]);
  };

  const calculateTotal = () => {
    const itemsTotal = cart.reduce((sum, item) => sum + item.price, 0);
    return (itemsTotal + CURBSIDE_FEE).toFixed(2);
  };

  const placeOrder = () => {
    if (!customerName || !carModel || !carColor) {
      alert("Please fill in your car details so we can find you!");
      return;
    }

    const newOrder = {
      id: Math.floor(Math.random() * 10000),
      customerName,
      carModel,
      carColor,
      plateNumber,
      items: cart,
      total: calculateTotal(),
      status: 'pending', // pending, ready, delivered
      timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
    };

    setActiveOrders([newOrder, ...activeOrders]);
    setCart([]);
    setView('success');
  };

  const updateOrderStatus = (orderId, newStatus) => {
    setActiveOrders(activeOrders.map(order => 
      order.id === orderId ? { ...order, status: newStatus } : order
    ));
  };

  const resetApp = () => {
    if(confirm("This will clear all orders and reset the demo. Are you sure?")) {
        setActiveOrders([]);
        setCart([]);
        setView('landing');
    }
  };

  // --- Screens ---

  const LandingPage = () => (
    <div className="flex flex-col items-center justify-center min-h-screen bg-stone-900 text-white p-6 text-center">
      <div className="bg-orange-500 p-4 rounded-full mb-6 animate-bounce">
        <Icons.Car />
      </div>
      <h1 className="text-5xl font-extrabold mb-2 tracking-tight">Pull Up Coffee</h1>
      <p className="text-stone-400 mb-8 text-lg max-w-md">
        Don't wake the baby. Don't find parking. 
        <br/>We run the coffee out to your car.
      </p>

      <div className="flex flex-col gap-4 w-full max-w-sm">
        <button 
          onClick={() => setView('customer')}
          className="bg-white text-stone-900 py-4 px-6 rounded-xl font-bold text-xl flex items-center justify-center gap-3 hover:bg-stone-200 transition shadow-lg"
        >
          <Icons.User />
          I want Coffee
        </button>
        <button 
          onClick={() => setView('cafe')}
          className="bg-stone-800 text-stone-300 py-4 px-6 rounded-xl font-semibold flex items-center justify-center gap-3 hover:bg-stone-700 transition border border-stone-700"
        >
          <Icons.Store />
          I'm a Cafe Owner
        </button>
      </div>
    </div>
  );

  const CustomerMenu = () => (
    <div className="min-h-screen bg-stone-50 pb-24">
      <div className="bg-white p-4 shadow-sm sticky top-0 z-10 flex justify-between items-center">
        <button onClick={() => setView('landing')} className="text-stone-500 hover:text-stone-900">
          <Icons.X />
        </button>
        <h2 className="font-bold text-xl text-stone-800">The Daily Grind</h2>
        <div className="w-6"></div>
      </div>

      <div className={`p-3 text-center text-sm font-semibold text-white ${isCafeOpen ? 'bg-green-600' : 'bg-red-500'}`}>
        {isCafeOpen ? 'ðŸŸ¢ Curbside Pickup Active' : 'ðŸ”´ Curbside Pickup Currently Unavailable'}
      </div>

      <div className="p-4 space-y-4">
        {MENU_ITEMS.map(item => (
          <div key={item.id} className="bg-white p-4 rounded-xl shadow-sm border border-stone-100 flex justify-between items-center">
            <div>
              <h3 className="font-bold text-stone-800 text-lg">{item.name}</h3>
              <p className="text-stone-500 text-sm">{item.desc}</p>
              <p className="text-orange-600 font-bold mt-1">${item.price.toFixed(2)}</p>
            </div>
            <button 
              disabled={!isCafeOpen}
              onClick={() => addToCart(item)}
              className={`w-10 h-10 rounded-full flex items-center justify-center transition ${
                isCafeOpen ? 'bg-stone-900 text-white hover:scale-110' : 'bg-stone-300 text-stone-500'
              }`}
            >
              +
            </button>
          </div>
        ))}
      </div>

      {cart.length > 0 && (
        <div className="fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-stone-200 shadow-lg">
          <div className="max-w-md mx-auto flex justify-between items-center">
            <div>
              <p className="text-stone-500 text-sm">{cart.length} items</p>
              <p className="font-bold text-xl text-stone-900">${calculateTotal()}</p>
            </div>
            <button 
              onClick={() => setView('checkout')}
              className="bg-orange-500 text-white py-3 px-8 rounded-full font-bold shadow-lg hover:bg-orange-600 transition flex items-center gap-2"
            >
              Checkout <Icons.ChevronRight />
            </button>
          </div>
        </div>
      )}
    </div>
  );

  const Checkout = () => (
    <div className="min-h-screen bg-stone-50 p-4">
      <button onClick={() => setView('customer')} className="mb-6 flex items-center text-stone-500 font-medium">
        <Icons.X /> <span className="ml-1">Back to Menu</span>
      </button>

      <h2 className="text-2xl font-extrabold text-stone-900 mb-6">Order Details</h2>

      <div className="bg-white p-6 rounded-2xl shadow-sm border border-stone-200 space-y-4 mb-6">
        <div>
          <label className="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Your Name</label>
          <input 
            type="text" 
            placeholder="e.g. Sarah"
            value={customerName}
            onChange={(e) => setCustomerName(e.target.value)}
            className="w-full p-3 bg-stone-50 rounded-lg border border-stone-200 focus:outline-none focus:border-orange-500"
          />
        </div>
        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Car Model</label>
            <input 
              type="text" 
              placeholder="e.g. Toyota"
              value={carModel}
              onChange={(e) => setCarModel(e.target.value)}
              className="w-full p-3 bg-stone-50 rounded-lg border border-stone-200 focus:outline-none focus:border-orange-500"
            />
          </div>
          <div>
            <label className="block text-xs font-bold text-stone-400 uppercase tracking-wider mb-1">Color</label>
            <input 
              type="text" 
              placeholder="e.g. Silver"
              value={carColor}
              onChange={(e) => setCarColor(e.target.value)}
              className="w-full p-3 bg-stone-50 rounded-lg border border-stone-200 focus:outline-none focus:border-orange-500"
            />
          </div>
        </div>
      </div>

      <div className="bg-white p-6 rounded-2xl shadow-sm border border-stone-200 mb-24">
        <h3 className="font-bold text-lg mb-4">Summary</h3>
        {cart.map((item) => (
          <div key={item.cartId} className="flex justify-between text-sm py-2 border-b border-stone-100">
            <span>{item.name}</span>
            <span>${item.price.toFixed(2)}</span>
          </div>
        ))}
        <div className="flex justify-between text-sm py-2 text-orange-600 font-medium">
          <span>Curbside Fee</span>
          <span>${CURBSIDE_FEE.toFixed(2)}</span>
        </div>
        <div className="flex justify-between font-bold text-xl mt-4 pt-4 border-t border-stone-200">
          <span>Total</span>
          <span>${calculateTotal()}</span>
        </div>
      </div>

      <button 
        onClick={placeOrder}
        className="fixed bottom-6 left-4 right-4 bg-stone-900 text-white py-4 rounded-xl font-bold text-xl shadow-xl hover:bg-stone-800 transition"
      >
        Pay & Park Up
      </button>
    </div>
  );

  const SuccessView = () => (
    <div className="min-h-screen bg-green-500 flex flex-col items-center justify-center p-6 text-white text-center">
      <div className="bg-white text-green-500 p-6 rounded-full mb-6 shadow-lg animate-pulse">
        <Icons.CheckCircle />
      </div>
      <h2 className="text-4xl font-extrabold mb-4">Order Sent!</h2>
      <p className="text-xl mb-8 font-medium">We are looking for your <span className="font-bold underline">{carColor} {carModel}</span>.</p>
      
      <button 
        onClick={() => {
            setCart([]);
            setView('landing');
        }}
        className="mt-12 text-white font-semibold hover:opacity-80 underline"
      >
        Back to Home
      </button>
    </div>
  );

  const CafeDashboard = () => (
    <div className="min-h-screen bg-stone-100 flex flex-col md:flex-row">
      {/* Sidebar */}
      <div className="bg-stone-900 text-stone-400 p-4 md:w-64 flex flex-row md:flex-col justify-between items-center md:items-stretch">
        <div className="flex items-center gap-3 text-white mb-0 md:mb-8">
          <div className="bg-orange-500 p-2 rounded-lg">
            <Icons.Coffee />
          </div>
          <span className="font-bold text-xl hidden md:block">CafePortal</span>
        </div>
        
        <div className="flex md:flex-col gap-2">
            <button onClick={resetApp} className="text-red-400 hover:text-red-300 text-sm flex items-center gap-2">
                <Icons.Trash2 /> <span className="hidden md:inline">Reset Demo</span>
            </button>
        </div>

        <button onClick={() => setView('landing')} className="flex items-center gap-3 text-sm hover:text-white mt-0 md:mt-auto">
             <Icons.X /> <span className="hidden md:block">Sign Out</span>
        </button>
      </div>

      {/* Main Content */}
      <div className="flex-1 p-6 overflow-y-auto">
        <div className="flex justify-between items-center mb-8">
          <h2 className="text-3xl font-bold text-stone-800">Live Dashboard</h2>
          
          <div className="flex items-center gap-3 bg-white p-2 rounded-xl shadow-sm px-4">
            <span className={`text-sm font-bold ${isCafeOpen ? 'text-green-600' : 'text-stone-400'}`}>
              {isCafeOpen ? 'Curbside: ON' : 'OFF'}
            </span>
            <button 
              onClick={() => setIsCafeOpen(!isCafeOpen)}
              className={`w-12 h-6 rounded-full p-1 transition-colors duration-300 ${isCafeOpen ? 'bg-green-500' : 'bg-stone-300'}`}
            >
              <div className={`bg-white w-4 h-4 rounded-full shadow-md transform transition-transform duration-300 ${isCafeOpen ? 'translate-x-6' : 'translate-x-0'}`}></div>
            </button>
          </div>
        </div>

        {activeOrders.length === 0 ? (
          <div className="flex flex-col items-center justify-center h-64 bg-white rounded-2xl border-2 border-dashed border-stone-300 text-stone-400">
            <div className="opacity-20 mb-4"><Icons.Coffee /></div>
            <p className="text-lg">No active orders yet.</p>
          </div>
        ) : (
          <div className="grid gap-6 grid-cols-1 lg:grid-cols-2 xl:grid-cols-3">
            {activeOrders.map(order => (
              <div key={order.id} className={`bg-white rounded-2xl shadow-sm border overflow-hidden ${order.status === 'delivered' ? 'opacity-50' : 'border-orange-200 shadow-orange-100'}`}>
                {/* Header */}
                <div className="bg-stone-50 p-4 border-b border-stone-100 flex justify-between items-start">
                  <div>
                     <div className="flex items-center gap-2 mb-1">
                        <div className="text-orange-600"><Icons.Car /></div>
                        <span className="font-bold text-stone-800 text-lg">{order.carModel}</span>
                     </div>
                     <div className="text-sm text-stone-600">
                        {order.carColor} {order.plateNumber}
                     </div>
                  </div>
                  <span className="text-xs font-bold text-stone-400">{order.timestamp}</span>
                </div>

                {/* Body */}
                <div className="p-4">
                  <p className="font-bold text-stone-900 mb-2">{order.customerName}</p>
                  <ul className="space-y-2 mb-4">
                    {order.items.map((item, idx) => (
                      <li key={idx} className="text-sm text-stone-600 flex justify-between">
                        <span>1x {item.name}</span>
                      </li>
                    ))}
                  </ul>
                  <div className="flex justify-between items-center text-sm font-bold pt-3 border-t border-stone-100">
                    <span className="text-stone-400">Total</span>
                    <span className="text-stone-800">${order.total}</span>
                  </div>
                </div>

                {/* Actions */}
                <div className="p-2 grid grid-cols-1 gap-2 bg-stone-50">
                   {order.status === 'pending' && (
                      <button className="bg-stone-800 text-white py-3 rounded-lg font-bold hover:bg-stone-700 transition w-full" onClick={() => updateOrderStatus(order.id, 'ready')}>
                        Mark Ready
                      </button>
                   )}
                   {order.status === 'ready' && (
                     <button className="bg-green-500 text-white py-3 rounded-lg font-bold hover:bg-green-600 transition w-full flex items-center justify-center gap-2" onClick={() => updateOrderStatus(order.id, 'delivered')}>
                       <Icons.MapPin /> Run to Car
                     </button>
                   )}
                   {order.status === 'delivered' && (
                     <div className="text-center text-green-600 font-bold py-2 flex items-center justify-center gap-2">
                       <Icons.CheckCircle /> Completed
                     </div>
                   )}
                </div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );

  return (
    <div className="font-sans text-stone-900">
      {view === 'landing' && <LandingPage />}
      {view === 'customer' && <CustomerMenu />}
      {view === 'cafe' && <CafeDashboard />}
      {view === 'checkout' && <Checkout />}
      {view === 'success' && <SuccessView />}
    </div>
  );
}
